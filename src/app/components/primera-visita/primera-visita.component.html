
<div class="primera-visita-container">
  <div class="visitas-list-container">
    <div class="header-section">
      <h1>Primeras Visitas</h1>
      <p-button 
        label="Nueva Visita" 
        icon="pi pi-plus" 
        (onClick)="showDialog()" 
        styleClass="p-button-primary">
      </p-button>
    </div>

    <p-table [value]="visitas" [paginator]="true" [rows]="10" [responsive]="true">
      <ng-template pTemplate="header">
        <tr>
          <th>Fecha</th>
          <th>Nombres</th>
          <th>Dirección</th>
          <th>Tipo de Persona</th>
          <th>Duración</th>
          <th>Próxima Visita</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-visita>
        <tr>
          <td>{{visita.date | date:'dd/MM/yyyy'}}</td>
          <td>{{visita.names}}</td>
          <td>{{visita.address}}</td>
          <td>{{visita.personType}}</td>
          <td>{{visita.duration}} minutos</td>
          <td>{{visita.nextVisitDate | date:'dd/MM/yyyy'}}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center">No hay visitas registradas</td>
        </tr>
      </ng-template>
      <p-button type="button" label="Ver Visitas" (onClick)="showDialog()" styleClass="p-button-info"></p-button>
    </p-table>


      <p-dialog header="Nueva Visita" [(visible)]="displayDialog" [modal]="true" [style]="{width: '90vw'}" [maximizable]="true">
        <form [formGroup]="visitaForm" (ngSubmit)="onSubmit()" class="visita-form">
          <div class="form-grid">
            <div class="field">
              <label for="date">Fecha</label>
              <p-calendar id="date" formControlName="date" [showIcon]="true" [showButtonBar]="true"></p-calendar>
              <small class="p-error" *ngIf="visitaForm.get('date')?.invalid && visitaForm.get('date')?.touched">
                La fecha es requerida
              </small>
            </div>
      
            <div class="field">
              <label for="nextVisitDate">Fecha Siguiente Visita</label>
              <p-calendar id="nextVisitDate" formControlName="nextVisitDate" [showIcon]="true" [showButtonBar]="true"></p-calendar>
              <small class="p-error" *ngIf="visitaForm.get('nextVisitDate')?.invalid && visitaForm.get('nextVisitDate')?.touched">
                La fecha de siguiente visita es requerida
              </small>
            </div>
      
            <div class="field">
              <label for="names">Nombres</label>
              <input id="names" type="text" pInputText formControlName="names">
              <small class="p-error" *ngIf="visitaForm.get('names')?.invalid && visitaForm.get('names')?.touched">
                El nombre es requerido
              </small>
            </div>
      
            <div class="field">
              <label for="address">Dirección</label>
              <input id="address" type="text" pInputText formControlName="address">
              <small class="p-error" *ngIf="visitaForm.get('address')?.invalid && visitaForm.get('address')?.touched">
                La dirección es requerida
              </small>
            </div>
      
            <div class="field">
              <label for="personType">Tipo de Persona</label>
              <p-dropdown id="personType" [options]="tiposPersona" formControlName="personType" 
                         placeholder="Seleccione un tipo" [showClear]="true"></p-dropdown>
              <small class="p-error" *ngIf="visitaForm.get('personType')?.invalid && visitaForm.get('personType')?.touched">
                El tipo de persona es requerido
              </small>
            </div>
      
            <div class="field">
              <label for="duration">Duración (minutos)</label>
              <p-inputNumber id="duration" formControlName="duration" [min]="1" [showButtons]="true"></p-inputNumber>
              <small class="p-error" *ngIf="visitaForm.get('duration')?.invalid && visitaForm.get('duration')?.touched">
                La duración es requerida y debe ser mayor a 0
              </small>
            </div>
      
            <div class="field col-12">
              <label for="initialQuestion">Pregunta Inicial</label>
              <textarea id="initialQuestion" pInputTextarea formControlName="initialQuestion" [rows]="3"></textarea>
              <small class="p-error" *ngIf="visitaForm.get('initialQuestion')?.invalid && visitaForm.get('initialQuestion')?.touched">
                La pregunta inicial es requerida
              </small>
            </div>
      
            <div class="field col-12">
              <label for="ownerConcern">Inquietud del Amo</label>
              <textarea id="ownerConcern" pInputTextarea formControlName="ownerConcern" [rows]="3"></textarea>
            </div>
      
            <div class="field col-12">
              <label for="personalData">Datos Personales</label>
              <textarea id="personalData" pInputTextarea formControlName="personalData" [rows]="3"></textarea>
            </div>
      
            <div class="field col-12">
              <label for="pendingQuestion">Pregunta Pendiente</label>
              <textarea id="pendingQuestion" pInputTextarea formControlName="pendingQuestion" [rows]="3"></textarea>
            </div>
      
            <div class="field col-12">
              <label for="notes">Notas</label>
              <textarea id="notes" pInputTextarea formControlName="notes" [rows]="3"></textarea>
            </div>
          </div>
      
          <div class="button-container">
            <p-button type="button" label="Cancelar" (onClick)="onCancel()" styleClass="p-button-secondary"></p-button>
            <p-button type="submit" label="Guardar" [disabled]="!visitaForm.valid"></p-button>
          </div>
        </form>
      </p-dialog>


<p-toast></p-toast>
</div>